---
permalink: /migration/
---

# How to migrate an existing project to .NET Standard or .NET Core

If you have an existing project and want to add support for .NET Standard or .NET Core, there are three parts to consider

- Use the new .NET Sdk tooling and msbuild
- Compatibility of codebase:
  - of BCL surface api used to .NET Standard or .NET Core
  - of dependencies
- Infrastructure (build script, requirements, tools)

**NOTE** The .NET Sdk doesnt support just .NET Core/Standard, but also normal .NET Framework.

That mean you can create a console app/lib to just target `net461` (.NET Framework 4.6.1).
Or both, so .net core (`netcoreapp2.0`) and `net461`

Best way is:



## Convert the library, target NETStandard

- create lib

```
cd src
mkdir FSharpx.Collections.NetStandard
dotnet new lib -lang F# -n FSharpx.Collections -o .
```

- delete useless source file

- Now copy the compile list to new lib from source lib

- fix path of Compile/None items

replace 

```
Include="
```

with

```
Include="..\FSharpx.Collections\
```

- remove `app.config`, useless on .net core
or make it conditional on target framework, if you want to maintain it.

- `dotnet build`

- `dotnet pack` it. Done.


## Convert the test

For tests, dependes on test framework.
Here is NUnit

See the [avaiable templates list for dotnet new](https://github.com/dotnet/templating/wiki/Available-templates-for-dotnet-new)

```
dotnet new -i "NUnit3.DotNetNew.Template::*"
```

now let's create the project.

```
cd tests
mkdir FSharpx.Collections.Tests.NetStandard
dotnet new nunit -lang F#
```

Tests can be run with `dotnet test`.

Let's reuse the existing tests now.

First remove the `UnitTest1.fs` generated by template.

After that, copy the same test list from source project, and update paths of `Compile` items

The dependencies in `paket.references` are `FsCheck` and `FsUnit`.

The `FsCheck` has a prerelease version who support .NET Standard, so let's try use that.

```
dotnet add package FsCheck --version 3.0.0-alpha1
```

and FsUnit

```
dotnet add package FsUnit --version 3.0.0
```

Now just the project reference to library:

```
dotnet add reference ..\..\src\FSharpx.Collections.NetStandard\FSharpx.Collections.fsproj
```

and let's test it with `dotnet test`

And there are errors. Usually because we upgraded version of out dependencies

**TIP** creating a solution now may help, because vscode can load just these projects
From root of repo:

```
dotnet new sln -n FSharpx.Collections.NetStandard
dotnet sln FSharpx.Collections.NetStandard.sln add src\FSharpx.Collections.NetStandard\FSharpx.Collections.fsproj
dotnet sln FSharpx.Collections.NetStandard.sln add tests\FSharpx.Collections.Tests.NetStandard\FSharpx.Collections.Tests.NetStandard.fsproj
```

And reload workspace with `> F#: Change Workspace or Solution`

Now back to the errors:

The nunit constraint `NullOrEmptyStringConstraint` doesnt exists anymore.
Quick fix, ifdef the code based on target framework. Better is to do it based on nunit version (or update the nunit for .net too)

```fsharp
#if NETCOREAPP2_0
#else
let NullOrEmptyString = new NullOrEmptyStringConstraint()
#endif
```

also `#if !NETCOREAPP2_0` can be used, if the project doesnt want to support older compilers

and fix build errors and tests until works :D

## add the netstandard to the package




<a name="custom-pack"></a>
## create nuget packages custom (no compilation)

